{
    {$CADDY_GLOBAL_OPTIONS}
    frankenphp {
        #worker /path/to/your/worker.php
        {$FRANKENPHP_CONFIG}
    }
}

{$CADDY_EXTRA_CONFIG}

# Main server block for general site handling
{$SERVER_NAME:localhost}, :443 {
    root * public/
    encode zstd br gzip
    tls /etc/caddy/certs/selfsigned.crt /etc/caddy/certs/selfsigned.key

    # Uncomment the following lines to enable Mercure and Vulcain modules
    # mercure {
    #     transport_url {$MERCURE_TRANSPORT_URL:bolt:///data/mercure.db}
    #     publisher_jwt {env.MERCURE_PUBLISHER_JWT_KEY} {env.MERCURE_PUBLISHER_JWT_ALG}
    #     subscriber_jwt {env.MERCURE_SUBSCRIBER_JWT_KEY} {env.MERCURE_SUBSCRIBER_JWT_ALG}
    #     anonymous
    #     subscriptions
    #     {$MERCURE_EXTRA_DIRECTIVES}
    # }
    # vulcain
    {$CADDY_SERVER_EXTRA_DIRECTIVES}
    php_server
}

# Stream redirect block
:443/stream , localhost/stream {
    root * public/
    encode zstd br gzip
    tls /etc/caddy/certs/selfsigned.crt /etc/caddy/certs/selfsigned.key

    header {
        # Ensure chunked transfer encoding
        Transfer-Encoding "chunked"
        # Prevent client-side caching (optional)
        Cache-Control "no-cache, no-store, must-revalidate"
        Pragma "no-cache"
        Expires "0"
    }

    # Redirect /stream to the Icecast stream URL
    redir /stream http://192.168.148.6:8004/cream.mp3 permanent
}
