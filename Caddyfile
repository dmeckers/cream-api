{
    {$CADDY_GLOBAL_OPTIONS}
    frankenphp {
        #worker /path/to/your/worker.php
        {$FRANKENPHP_CONFIG}
    }
}

{$CADDY_EXTRA_CONFIG}

# Primary server block with self-signed certificate
:443 {
    root * public/
    encode zstd br gzip

    # Check if the self-signed certs exist and use them
    @selfsigned {
        file /etc/caddy/certs/selfsigned.crt
        file /etc/caddy/certs/selfsigned.key
    }

    handle @selfsigned {
        tls /etc/caddy/certs/selfsigned.crt /etc/caddy/certs/selfsigned.key
        {$CADDY_SERVER_EXTRA_DIRECTIVES}
        php_server
    }

    # Fallback to another directory if self-signed certs do not exist
    handle {
        {$CADDY_SERVER_EXTRA_DIRECTIVES}
        php_server
    }
}

# Stream redirect block
:443/stream {
    root * public/
    encode zstd br gzip

    tls /etc/caddy/certs/selfsigned.crt /etc/caddy/certs/selfsigned.key
    header {
        Transfer-Encoding "chunked"
        Cache-Control "no-cache, no-store, must-revalidate"
        Pragma "no-cache"
        Expires "0"
    }

    redir /stream http://cream-cast:8004/cream.mp3 permanent
}
