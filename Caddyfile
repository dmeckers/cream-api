{
    {$CADDY_GLOBAL_OPTIONS}
    frankenphp {
        #worker /path/to/your/worker.php
        {$FRANKENPHP_CONFIG}
    }
}

{$CADDY_EXTRA_CONFIG}

# Primary server block with custom TLS certificate
https://cream-fm.art {
    root * public/
    encode zstd br gzip
    tls internal

    {$CADDY_SERVER_EXTRA_DIRECTIVES}
    php_server
}

# Stream proxy block
https://cream-fm.art/stream {
    # Match the path for streaming
    @stream path /stream/*

    # Rewrite the path so that /stream maps to /cream.mp3 in the upstream service
    rewrite @stream /cream.mp3

    # Reverse proxy with base URL only
    reverse_proxy @stream http://cream-cast:8004

    encode zstd br gzip
    tls internal
